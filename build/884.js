"use strict";(globalThis.webpackChunkumroh_manager_hybrid_src=globalThis.webpackChunkumroh_manager_hybrid_src||[]).push([[884],{884:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var n=a(609),r=a(899),l=a(313);function s(){const{api:e}=(0,r.g)(),[t,a]=(0,n.useState)(null),[s,c]=(0,n.useState)([]),[i,o]=(0,n.useState)(!0),[m,d]=(0,n.useState)(new Date),[u,g]=(0,n.useState)(null),[h,x]=(0,n.useState)(""),[b,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=setInterval(()=>d(new Date),1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{k(),y()},[]);const k=async()=>{try{const t=await e.get("/attendance/today");a(t);const n=await e.get("/attendance/history");c(n)}catch(e){console.error(e)}finally{o(!1)}},y=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{g({lat:e.coords.latitude,lng:e.coords.longitude}),x("")},e=>{console.error(e),x("Gagal mengambil lokasi. Pastikan GPS aktif dan izin diberikan.")},{enableHighAccuracy:!0}):x("Browser Anda tidak mendukung Geolocation.")},f=async t=>{if(!u)return alert("Sedang mencari lokasi GPS... Tunggu sebentar atau refresh halaman."),void y();p(!0);try{await e.post("/attendance/clock",{type:t,lat:u.lat,lng:u.lng}),alert("in"===t?"Selamat bekerja! Absen masuk berhasil.":"Terima kasih! Hati-hati di jalan."),k()}catch(e){alert(e.message||"Gagal melakukan presensi.")}finally{p(!1)}};if(i)return(0,n.createElement)(l.A,null);const E="checked_in"===t?.status,w=t?.can_check_out;return(0,n.createElement)("div",{className:"max-w-md mx-auto space-y-6 pb-10"},(0,n.createElement)("div",{className:"text-center py-4"},(0,n.createElement)("h1",{className:"text-2xl font-bold text-gray-800"},"Presensi Karyawan"),(0,n.createElement)("p",{className:"text-sm text-gray-500"},"PT. Travel Umrah Banten")),(0,n.createElement)("div",{className:"bg-white rounded-2xl shadow-lg p-6 text-center border border-gray-100"},(0,n.createElement)("div",{className:"text-gray-500 text-sm font-medium mb-2"},m.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),(0,n.createElement)("div",{className:"text-5xl font-bold text-blue-600 tracking-tight font-mono mb-4"},m.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})),(0,n.createElement)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium "+(u?"bg-green-100 text-green-800":"bg-red-100 text-red-800")},(0,n.createElement)("span",{className:"w-2 h-2 rounded-full mr-2 "+(u?"bg-green-500 animate-pulse":"bg-red-500")}),u?"GPS Terkunci Akurat":"Mencari GPS..."),h&&(0,n.createElement)("p",{className:"text-xs text-red-500 mt-2"},h)),(0,n.createElement)("div",{className:"grid grid-cols-2 gap-4"},(0,n.createElement)("button",{onClick:()=>f("in"),disabled:E||b||!u,className:"p-6 rounded-xl shadow-md flex flex-col items-center justify-center transition-all transform active:scale-95 "+(E?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gradient-to-br from-blue-500 to-blue-600 text-white hover:shadow-lg")},(0,n.createElement)("svg",{className:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,n.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})),(0,n.createElement)("span",{className:"font-bold text-lg"},"Absen Masuk"),E&&(0,n.createElement)("span",{className:"text-xs mt-1"},t?.data?.check_in_time?.split(" ")[1])),(0,n.createElement)("button",{onClick:()=>f("out"),disabled:!E||!w||b||!u,className:"p-6 rounded-xl shadow-md flex flex-col items-center justify-center transition-all transform active:scale-95 "+(E&&w?"bg-gradient-to-br from-red-500 to-red-600 text-white hover:shadow-lg":"bg-gray-100 text-gray-400 cursor-not-allowed")},(0,n.createElement)("svg",{className:"w-10 h-10 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},(0,n.createElement)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})),(0,n.createElement)("span",{className:"font-bold text-lg"},"Absen Pulang"),t?.data?.check_out_time&&(0,n.createElement)("span",{className:"text-xs mt-1"},t?.data?.check_out_time?.split(" ")[1]))),E&&t?.data&&(0,n.createElement)("div",{className:"bg-white p-4 rounded-lg shadow border border-gray-200"},(0,n.createElement)("h3",{className:"text-sm font-bold text-gray-700 mb-2"},"Lokasi Anda Hari Ini"),(0,n.createElement)("div",{className:"aspect-video w-full bg-gray-200 rounded overflow-hidden relative"},(0,n.createElement)("iframe",{width:"100%",height:"100%",frameBorder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:`https://maps.google.com/maps?q=${t.data.check_in_lat},${t.data.check_in_lng}&z=15&output=embed`})),(0,n.createElement)("div",{className:"mt-2 flex justify-between text-xs text-gray-500"},(0,n.createElement)("span",null,"Masuk: ",t.data.check_in_time),t.data.check_out_time&&(0,n.createElement)("span",null,"Pulang: ",t.data.check_out_time))),(0,n.createElement)("div",null,(0,n.createElement)("h3",{className:"text-lg font-bold text-gray-800 mb-3 px-2"},"Riwayat 30 Hari Terakhir"),(0,n.createElement)("div",{className:"space-y-3"},s.map(e=>(0,n.createElement)("div",{key:e.id,className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center"},(0,n.createElement)("div",null,(0,n.createElement)("div",{className:"font-bold text-gray-800"},new Date(e.date).toLocaleDateString("id-ID",{weekday:"short",day:"numeric",month:"short"})),(0,n.createElement)("div",{className:"text-xs text-gray-500 mt-1"},(0,n.createElement)("span",{className:"text-green-600 font-medium"},"IN: ",e.check_in_time?e.check_in_time.split(" ")[1]:"-"),(0,n.createElement)("span",{className:"mx-2"},"|"),(0,n.createElement)("span",{className:"text-red-600 font-medium"},"OUT: ",e.check_out_time?e.check_out_time.split(" ")[1]:"-"))),(0,n.createElement)("div",null,(0,n.createElement)("span",{className:"px-2 py-1 rounded text-xs font-bold uppercase "+("present"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")},e.status)))),0===s.length&&(0,n.createElement)("p",{className:"text-center text-gray-500 py-4"},"Belum ada riwayat presensi."))))}}}]);